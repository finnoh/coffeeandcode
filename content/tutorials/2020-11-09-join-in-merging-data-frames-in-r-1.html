---
title: Join in! Merging Data Frames in R (Part 1)
author: Finn
date: '2020-11-09'
slug: join-in-merging-data-frames-in-r
categories:
  - R
tags:
  - tutorial
  - data cleaning
  - basic
  - tidyverse
image: images/ny1.jpg
image_credit:
code_lang: "R"
description: "Awesome R code here"
weight: 100
bibliography: join_tut.bib
nocite: '@*'

---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>
  <link rel="stylesheet" href="\css\custom.css" type="text/css" />


<p><img style="width:100%;" id="image" src="/images/ny1.jpg"></p>
<p><span>Photo by <a href="https://unsplash.com/@csoref?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Colton Duke</a> on <a href="https://unsplash.com/s/photos/new-york?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## -- Attaching packages ----------------------------------------------------------------------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.0     v purrr   0.3.3
## v tibble  2.1.3     v dplyr   1.0.2
## v tidyr   1.0.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.4.0</code></pre>
<pre><code>## -- Conflicts -------------------------------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter()     masks stats::filter()
## x dplyr::group_rows() masks kableExtra::group_rows()
## x dplyr::lag()        masks stats::lag()</code></pre>
<div id="where-are-the-himym-actors-from" class="section level1">
<h1>Where are the HIMYM actors from?</h1>
<p>If you are a fan of the famous “How I Met your Mother” series, you know the main characters and some facts about their backgrounds and professions. You know that Ted is an architect and from the various jokes about Canada, you know that Robin is from well, Canada. But where are the actors of these characters from? To explore this question, we need to combine information from different data sources: data on the characters and data on the cast (see <a href="#tab:char">2</a>). Let us take a look at the ways in which we can bring the information together.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># generate some data</span></span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>d_characters &lt;-</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">data.frame</span>(</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="st">&quot;Name&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Ted&quot;</span>, <span class="st">&quot;Marshall&quot;</span>, <span class="st">&quot;Lily&quot;</span>, <span class="st">&quot;Robin&quot;</span>, <span class="st">&quot;Barney&quot;</span>, <span class="st">&quot;Viktoria&quot;</span>),</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="st">&quot;Job&quot;</span> =<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb5-7"><a href="#cb5-7"></a>      <span class="st">&quot;Architect&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>      <span class="st">&quot;Lawyer&quot;</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>      <span class="st">&quot;Teacher&quot;</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>      <span class="st">&quot;News-Anchor&quot;</span>,</span>
<span id="cb5-11"><a href="#cb5-11"></a>      <span class="st">&quot;PLEASE&quot;</span>,</span>
<span id="cb5-12"><a href="#cb5-12"></a>      <span class="st">&quot;Pastry chef&quot;</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>    ),</span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="st">&quot;Year_of_Birth&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1978</span>, <span class="dv">1978</span>, <span class="dv">1978</span>, <span class="dv">1980</span>, <span class="dv">1976</span>, <span class="dv">1980</span>), <span class="st">&quot;Origin&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Shaker Heights&quot;</span>,<span class="st">&quot;St. Cloud&quot;</span>,<span class="st">&quot;Brooklyn&quot;</span>, <span class="st">&quot;Vancouver&quot;</span>, <span class="st">&quot;Staten Island&quot;</span>, <span class="ot">NA</span>)</span>
<span id="cb5-15"><a href="#cb5-15"></a>  )</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a>d_cast &lt;-</span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="st">  </span><span class="kw">data.frame</span>(</span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="st">&quot;Name&quot;</span> =<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb5-20"><a href="#cb5-20"></a>      <span class="st">&quot;Josh Radnor&quot;</span>,</span>
<span id="cb5-21"><a href="#cb5-21"></a>      <span class="st">&quot;Bob Saget&quot;</span>,</span>
<span id="cb5-22"><a href="#cb5-22"></a>      <span class="st">&quot;Jason Segel&quot;</span>,</span>
<span id="cb5-23"><a href="#cb5-23"></a>      <span class="st">&quot;Alyson Hannigan&quot;</span>,</span>
<span id="cb5-24"><a href="#cb5-24"></a>      <span class="st">&quot;Cobie Smulders&quot;</span>,</span>
<span id="cb5-25"><a href="#cb5-25"></a>      <span class="st">&quot;Neil Patrick Harris&quot;</span>,</span>
<span id="cb5-26"><a href="#cb5-26"></a>      <span class="st">&quot;Cristin Millioti&quot;</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>    ),</span>
<span id="cb5-28"><a href="#cb5-28"></a>    <span class="st">&quot;Role&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Ted&quot;</span>, <span class="st">&quot;Ted&quot;</span>, <span class="st">&quot;Marshall&quot;</span>, <span class="st">&quot;Lily&quot;</span>, <span class="st">&quot;Robin&quot;</span>, <span class="st">&quot;Barney&quot;</span>, <span class="st">&quot;Tracy&quot;</span>),</span>
<span id="cb5-29"><a href="#cb5-29"></a>    <span class="st">&quot;Birthplace&quot;</span> =<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb5-30"><a href="#cb5-30"></a>      <span class="st">&quot;Ohio&quot;</span>,</span>
<span id="cb5-31"><a href="#cb5-31"></a>      <span class="st">&quot;Pennsylvania&quot;</span>,</span>
<span id="cb5-32"><a href="#cb5-32"></a>      <span class="st">&quot;California&quot;</span>,</span>
<span id="cb5-33"><a href="#cb5-33"></a>      <span class="st">&quot;Washington D.C.&quot;</span>,</span>
<span id="cb5-34"><a href="#cb5-34"></a>      <span class="st">&quot;British Columbia&quot;</span>,</span>
<span id="cb5-35"><a href="#cb5-35"></a>      <span class="st">&quot;New Mexico&quot;</span>,</span>
<span id="cb5-36"><a href="#cb5-36"></a>      <span class="st">&quot;New Jersey&quot;</span></span>
<span id="cb5-37"><a href="#cb5-37"></a>    )</span>
<span id="cb5-38"><a href="#cb5-38"></a>  )</span></code></pre></div>
<table class=" lightable-material lightable-hover" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
<span id="tab:cast">Table 1: </span>The main cast of HIMYM
</caption>
<thead>
<tr>
<th style="text-align:center;">
Name
</th>
<th style="text-align:center;">
Role
</th>
<th style="text-align:center;">
Birthplace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Josh Radnor
</td>
<td style="text-align:center;">
Ted
</td>
<td style="text-align:center;">
Ohio
</td>
</tr>
<tr>
<td style="text-align:center;">
Bob Saget
</td>
<td style="text-align:center;">
Ted
</td>
<td style="text-align:center;">
Pennsylvania
</td>
</tr>
<tr>
<td style="text-align:center;">
Jason Segel
</td>
<td style="text-align:center;">
Marshall
</td>
<td style="text-align:center;">
California
</td>
</tr>
<tr>
<td style="text-align:center;">
Alyson Hannigan
</td>
<td style="text-align:center;">
Lily
</td>
<td style="text-align:center;">
Washington D.C.
</td>
</tr>
<tr>
<td style="text-align:center;">
Cobie Smulders
</td>
<td style="text-align:center;">
Robin
</td>
<td style="text-align:center;">
British Columbia
</td>
</tr>
<tr>
<td style="text-align:center;">
Neil Patrick Harris
</td>
<td style="text-align:center;">
Barney
</td>
<td style="text-align:center;">
New Mexico
</td>
</tr>
<tr>
<td style="text-align:center;">
Cristin Millioti
</td>
<td style="text-align:center;">
Tracy
</td>
<td style="text-align:center;">
New Jersey
</td>
</tr>
</tbody>
</table>
<table class=" lightable-material lightable-hover" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
<span id="tab:char">Table 2: </span>The main characters of HIMYM
</caption>
<thead>
<tr>
<th style="text-align:center;">
Name
</th>
<th style="text-align:center;">
Job
</th>
<th style="text-align:center;">
Year_of_Birth
</th>
<th style="text-align:center;">
Origin
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Ted
</td>
<td style="text-align:center;">
Architect
</td>
<td style="text-align:center;">
1978
</td>
<td style="text-align:center;">
Shaker Heights
</td>
</tr>
<tr>
<td style="text-align:center;">
Marshall
</td>
<td style="text-align:center;">
Lawyer
</td>
<td style="text-align:center;">
1978
</td>
<td style="text-align:center;">
St. Cloud
</td>
</tr>
<tr>
<td style="text-align:center;">
Lily
</td>
<td style="text-align:center;">
Teacher
</td>
<td style="text-align:center;">
1978
</td>
<td style="text-align:center;">
Brooklyn
</td>
</tr>
<tr>
<td style="text-align:center;">
Robin
</td>
<td style="text-align:center;">
News-Anchor
</td>
<td style="text-align:center;">
1980
</td>
<td style="text-align:center;">
Vancouver
</td>
</tr>
<tr>
<td style="text-align:center;">
Barney
</td>
<td style="text-align:center;">
PLEASE
</td>
<td style="text-align:center;">
1976
</td>
<td style="text-align:center;">
Staten Island
</td>
</tr>
<tr>
<td style="text-align:center;">
Viktoria
</td>
<td style="text-align:center;">
Pastry chef
</td>
<td style="text-align:center;">
1980
</td>
<td style="text-align:center;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="combining-data-sets" class="section level1">
<h1>Combining data sets</h1>
<p>We make use of <code>dplyr</code> join functions to bring two data tables together. A join works by using a “key” column, that uniquely identifies observations in one of the data sets. This key serves as a “puzzle piece” to bring the tables together. The key is the column that shows up in both data sources, in our case it is the information regarding the respective role (called <code>d_cast$Role</code> and <code>d_characters$Name$</code>).</p>
<div id="making-use-of-an-inner-join" class="section level2">
<h2>Making use of an Inner Join</h2>
<p><img src="/tutorials/2020-11-09-join-in-merging-data-frames-in-r-1_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>The first way how we can bring two tables together is by an inner join. Here, the resulting data frame consists of only the observations, whose key value shows up in both tables. We take a first approach below with the <code>inner_join()</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># use inner join to merge the two dataframes</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>df &lt;-<span class="st"> </span><span class="kw">inner_join</span>(d_cast, d_characters)</span></code></pre></div>
<pre><code>## Joining, by = &quot;Name&quot;</code></pre>
<table class=" lightable-material lightable-hover" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
<span id="tab:innerA">Table 3: </span>This empty dataframe is the result of the inner join - We got a problem …
</caption>
<thead>
<tr>
<th style="text-align:center;">
Name
</th>
<th style="text-align:center;">
Role
</th>
<th style="text-align:center;">
Birthplace
</th>
<th style="text-align:center;">
Job
</th>
<th style="text-align:center;">
Year_of_Birth
</th>
<th style="text-align:center;">
Origin
</th>
</tr>
</thead>
<tbody>
<tr>
</tr>
</tbody>
</table>
<p>Oh oh, that does not look right - Why is the resulting data frame (see <a href="#tab:innerA">3</a>) empty? Take a look at the output message above: the <code>inner_join</code> function used the <code>Name</code> column as the key, because it is the only column that has the same <em>name</em> in both data frames. Here lies the mistake: While it is named the same, it does not contain the same information! <code>d_cast$Name</code> resembles the name of the actor and not the name of the fictional character (like <code>d_character$Name</code> does).</p>
<p>Luckily, we can make use of the <code>by=...</code> argument in the <code>inner_join()</code> function to specify which columns we want to line up with each other. Often times, it makes sense to rename some columns after merging to not confuse them with others. We can see the result of the improved join in <a href="#tab:innerB">4</a>: Nice! We got a matching of the five main characters, exactly what we have been looking for. Notice how there are two matches for the character Ted: One for his actor Josh Radnor and one for his narrator Bob Saget.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># use inner join to merge the two dataframes</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>df &lt;-<span class="st"> </span><span class="kw">inner_join</span>(d_cast, d_characters, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Role&quot;</span> =<span class="st"> &quot;Name&quot;</span>))</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># rename the Birthplace column, so that we know it refers to the birthplace of the actor</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">Birthplace_actor =</span> Birthplace)</span></code></pre></div>
<table class=" lightable-material lightable-hover" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
<span id="tab:innerB">Table 4: </span>It looks much better now!
</caption>
<thead>
<tr>
<th style="text-align:center;">
Name
</th>
<th style="text-align:center;">
Role
</th>
<th style="text-align:center;">
Birthplace_actor
</th>
<th style="text-align:center;">
Job
</th>
<th style="text-align:center;">
Year_of_Birth
</th>
<th style="text-align:center;">
Origin
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Josh Radnor
</td>
<td style="text-align:center;">
Ted
</td>
<td style="text-align:center;">
Ohio
</td>
<td style="text-align:center;">
Architect
</td>
<td style="text-align:center;">
1978
</td>
<td style="text-align:center;">
Shaker Heights
</td>
</tr>
<tr>
<td style="text-align:center;">
Bob Saget
</td>
<td style="text-align:center;">
Ted
</td>
<td style="text-align:center;">
Pennsylvania
</td>
<td style="text-align:center;">
Architect
</td>
<td style="text-align:center;">
1978
</td>
<td style="text-align:center;">
Shaker Heights
</td>
</tr>
<tr>
<td style="text-align:center;">
Jason Segel
</td>
<td style="text-align:center;">
Marshall
</td>
<td style="text-align:center;">
California
</td>
<td style="text-align:center;">
Lawyer
</td>
<td style="text-align:center;">
1978
</td>
<td style="text-align:center;">
St. Cloud
</td>
</tr>
<tr>
<td style="text-align:center;">
Alyson Hannigan
</td>
<td style="text-align:center;">
Lily
</td>
<td style="text-align:center;">
Washington D.C.
</td>
<td style="text-align:center;">
Teacher
</td>
<td style="text-align:center;">
1978
</td>
<td style="text-align:center;">
Brooklyn
</td>
</tr>
<tr>
<td style="text-align:center;">
Cobie Smulders
</td>
<td style="text-align:center;">
Robin
</td>
<td style="text-align:center;">
British Columbia
</td>
<td style="text-align:center;">
News-Anchor
</td>
<td style="text-align:center;">
1980
</td>
<td style="text-align:center;">
Vancouver
</td>
</tr>
<tr>
<td style="text-align:center;">
Neil Patrick Harris
</td>
<td style="text-align:center;">
Barney
</td>
<td style="text-align:center;">
New Mexico
</td>
<td style="text-align:center;">
PLEASE
</td>
<td style="text-align:center;">
1976
</td>
<td style="text-align:center;">
Staten Island
</td>
</tr>
</tbody>
</table>
<blockquote>
<p>In the upcoming parts of this series, we will take a look at other forms of joins for example left and right joins.</p>
</blockquote>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-join_dplyr">
<p>Hadley Wickham, Lionel Henry, Romain François. 2020. “Join Two Tbls Together — Join • Dplyr.” <a href="https://dplyr.tidyverse.org/reference/join.html">https://dplyr.tidyverse.org/reference/join.html</a>.</p>
</div>
</div>
</div>
